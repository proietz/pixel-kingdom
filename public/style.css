const grid = document.getElementById("grid");

// CREA 20.000 blocchi (200 x 100)
for (let i = 0; i < 20000; i++) {
const block = document.createElement("div");
block.className = "block";
block.dataset.id = i;

// CLICK PER APRIRE POPUP CELLE ACQUISTATE
block.addEventListener("click", () => {
const purchasedBlock = purchasedBlocks.find(b => b.id === i);
if (purchasedBlock) {
showPopup(purchasedBlock);
} else {
window.location.href = `/buy.html?id=${i}`;
}
});

grid.appendChild(block);
}

// MEMORIZZA BLOCCHI ACQUISTATI
let purchasedBlocks = [];

// CARICA BLOCCCHI ACQUISTATI DAL SERVER
fetch("/api/blocks")
.then(res => res.json())
.then(blocks => {
purchasedBlocks = blocks.map(b => ({
id: b.id,
title: b.title,
image: b.image,
link: b.link
}));

purchasedBlocks.forEach(b => {
const el = document.querySelector(`.block[data-id="${b.id}"]`);
if (el) {
el.style.backgroundImage = `url(${b.image})`;
el.dataset.title = b.title;
el.dataset.link = b.link;
}
});
});

// FUNZIONE PER MOSTRARE POPUP DETTAGLI
function showPopup(block) {
// CREA OVERLAY
const overlay = document.createElement("div");
overlay.id = "popupOverlay";

// CREA BOX DEL POPUP
const popup = document.createElement("div");
popup.id = "popupBox";

// TITOLO
const title = document.createElement("h3");
title.textContent = block.title || "No title";
popup.appendChild(title);

// IMMAGINE
if (block.image) {
const img = document.createElement("img");
img.src = block.image;
popup.appendChild(img);
}

// LINK
if (block.link) {
const link = document.createElement("a");
link.href = block.link;
link.textContent = "Go to link";
link.target = "_blank";
popup.appendChild(link);
}

// CHIUDI POPUP
const closeBtn = document.createElement("button");
closeBtn.textContent = "Close";
closeBtn.onclick = () => document.body.removeChild(overlay);
popup.appendChild(closeBtn);

overlay.appendChild(popup);
document.body.appendChild(overlay);
}