<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Buy Blocks - Pixel Kingdom</title>
<link rel="stylesheet" href="style.css">
<style>
body {
font-family: Arial, Helvetica, sans-serif;
background: #fff;
color: #000;
text-align: center;
}
h1 { margin-top: 20px; }
form { display: inline-block; text-align: left; margin-top: 20px; }
label { display: block; margin-top: 10px; }
input[type="text"], input[type="url"], textarea {
width: 300px;
padding: 5px;
margin-top: 3px;
}
#total-info { margin-top: 15px; font-weight: bold; }
#terms { margin-top: 10px; }
button { margin-top: 20px; padding: 10px 20px; font-size: 14px; }
</style>
</head>
<body>

<h1>Purchase Blocks</h1>

<p id="total-info"></p>

<form id="buy-form">
<label>
Title (required):
<input type="text" id="title" placeholder="Enter title" required>
</label>

<label>
Text:
<textarea id="text" placeholder="Optional text"></textarea>
</label>

<label>
Image URL:
<input type="url" id="image" placeholder="Optional image URL">
</label>

<label>
Link URL:
<input type="url" id="link" placeholder="Optional link URL">
</label>

<label>
Color pattern:
<input type="text" id="color" placeholder="Optional color (hex or name)">
</label>

<div id="terms">
<input type="checkbox" id="accept-terms" required>
<label for="accept-terms">I accept <a href="terms.html" target="_blank">Terms and Conditions</a></label>
</div>

<button type="submit">Buy</button>
</form>

<script>
// Recupera parametri dalla URL
const urlParams = new URLSearchParams(window.location.search);
const firstId = parseInt(urlParams.get("id")) || 0;
const totalBlocks = parseInt(urlParams.get("total")) || 1;
const pricePerBlock = 1; // 1€ per blocco 10x10
const totalPrice = totalBlocks * pricePerBlock;

// Mostra numero di blocchi e prezzo
const totalInfo = document.getElementById("total-info");
totalInfo.textContent = `${totalBlocks} block${totalBlocks > 1 ? "s" : ""} selected. Total price: €${totalPrice}`;

const form = document.getElementById("buy-form");

form.addEventListener("submit", (e) => {
e.preventDefault();

const title = document.getElementById("title").value.trim();
const text = document.getElementById("text").value.trim();
const image = document.getElementById("image").value.trim();
const link = document.getElementById("link").value.trim();
const color = document.getElementById("color").value.trim();
const acceptTerms = document.getElementById("accept-terms").checked;

if (!acceptTerms) {
alert("You must accept the Terms and Conditions before purchasing.");
return;
}

if (!title) {
alert("Title is required.");
return;
}

// Prepara i dati da inviare al server
const payload = {
id: firstId,
total: totalBlocks,
title,
text,
image,
link,
color
};

// Simulazione acquisto (puoi collegare Stripe qui)
fetch("/api/buy", {
method: "POST",
headers: { "Content-Type": "application/json" },
body: JSON.stringify(payload)
})
.then(res => res.json())
.then(data => {
if (data.success) {
alert(`Purchase successful!\nFirst block ID: ${firstId}\nTotal blocks: ${totalBlocks}`);
window.location.href = "/"; // torna alla homepage
} else {
alert("Purchase failed. Please try again.");
}
});
});
</script>

</body>
</html>