<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Buy Block - Pixel Kingdom</title>
<link rel="stylesheet" href="style.css">
</head>
<body>
<h1>Purchase Block(s)</h1>
<p id="block-info">Loading...</p>

<form id="purchase-form">
<label>Title (required):</label><br>
<input type="text" name="title" required placeholder="Enter title"><br><br>

<label>Image (optional):</label><br>
<input type="file" name="image"><br><br>

<label>Text (optional):</label><br>
<input type="text" name="text"><br><br>

<label>Link/URL (optional):</label><br>
<input type="text" name="link"><br><br>

<label>Pattern color (optional):</label><br>
<input type="color" name="color"><br><br>

<input type="checkbox" name="terms" required>
<label>I accept <a href="terms.html" target="_blank">Terms and Conditions</a></label><br><br>

<button type="submit">Purchase</button>
<button type="button" onclick="history.back()">Back</button>
</form>

<script>
const params = new URLSearchParams(window.location.search);
const blockId = params.get('id');
const count = parseInt(params.get('count')) || 1;

document.getElementById('block-info').innerHTML =
`You are purchasing ${count} block(s) of 10×10 pixels.<br>Total price: ${count * 100}€`;

document.getElementById('purchase-form').addEventListener('submit', e => {
e.preventDefault();
const formData = new FormData(e.target);

const data = {
id: blockId,
count: count,
title: formData.get('title'),
image: '', // qui puoi gestire upload reale
link: formData.get('link')
};

fetch('/api/buy', {
method: 'POST',
headers: { 'Content-Type': 'application/json' },
body: JSON.stringify(data)
}).then(res => res.json())
.then(r => {
if (r.success) {
alert(`Purchase successful! Your blocks start at #${blockId}`);
window.location.href = '/';
}
});
});
</script>
</body>
</html>